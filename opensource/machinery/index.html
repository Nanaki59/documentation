<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://staging.doc.kerberos.live/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://staging.doc.kerberos.live/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://staging.doc.kerberos.live/main.9857ee75bdb7a1a0e48b07acefde1e131e0ed35e2639929b1e03613a1d21122e2f3291e015114676f812f1c97979d0c803522b3afd0e720eb2b1378b5e369256.css integrity="sha512-mFfudb23oaDkiwes794eEx4O014mOZKbHgNhOh0hEi4vMpHgFRFGdvgS8cl5edDIA1IrOv0Ocg6ysTeLXjaSVg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Machinery - Kerberos.io</title><meta name=description content="Doks is a Hugo theme helping you build modern documentation websites that are secure, fast, and SEO-ready â€” by default."><link rel=canonical href=https://staging.doc.kerberos.live/opensource/machinery/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/doks.png"><meta name=twitter:title content="Machinery"><meta name=twitter:description content="The machinery is the processing engine of Kerberos Open Source. It&rsquo;s an image processing framework, written in C++, who benefits from other third party libraries (OpenCV, etc). It takes images from the type of camera (USB-, IP- or RPi-camera) you&rsquo;ve configured in the configuration files and executes one ore more algorithms and post-processes (e.g. save a snapshot). The configuration files allow you to define the type of camera, post-processes, conditions and much more; it&rsquo;s highly configurable."><meta name=twitter:site content="@henkverlinde"><meta name=twitter:creator content="@henkverlinde"><meta property="og:title" content="Machinery"><meta property="og:description" content="The machinery is the processing engine of Kerberos Open Source. It&rsquo;s an image processing framework, written in C++, who benefits from other third party libraries (OpenCV, etc). It takes images from the type of camera (USB-, IP- or RPi-camera) you&rsquo;ve configured in the configuration files and executes one ore more algorithms and post-processes (e.g. save a snapshot). The configuration files allow you to define the type of camera, post-processes, conditions and much more; it&rsquo;s highly configurable."><meta property="og:type" content="article"><meta property="og:url" content="/opensource/machinery/"><meta property="og:image" content="/doks.png"><meta property="article:published_time" content="2020-10-06T08:49:31+00:00"><meta property="article:modified_time" content="2020-10-06T08:49:31+00:00"><meta property="og:site_name" content="Kerberos.io"><meta property="article:publisher" content="https://www.facebook.com/verlinde.henk"><meta property="article:author" content="https://www.facebook.com/verlinde.henk"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/staging.doc.kerberos.live\/"},{"@type":"ListItem","position":3,"name":"Opensource","item":"https:\/\/staging.doc.kerberos.live\/\/opensource\/"},{"@type":"ListItem","position":4,"name":"Machinery","item":"https:\/\/staging.doc.kerberos.live\/\/opensource\/machinery\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://staging.doc.kerberos.live/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://staging.doc.kerberos.live/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://staging.doc.kerberos.live/favicons/favicon-16x16.png><link rel=manifest href=https://staging.doc.kerberos.live/site.webmanifest></head><body class="opensource single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://staging.doc.kerberos.live/>Kerberos.io</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://twitter.com/getdoks><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg><span class="ms-2 visually-hidden">Twitter</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/h-enk/doks><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://staging.kerberos.live>Products</a></li><li class=nav-item><a class=nav-link href=https://staging.kerberos.live>Blog</a></li><li class=nav-item><a class=nav-link href=https://staging.doc.kerberos.live/prologue/introduction/>Docs & Guides</a></li><li class=nav-item><a class=nav-link href=https://staging.kerberos.live>About & Contact</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><h3>Prologue</h3><ul class=list-unstyled><li><a class=docs-link href=https://staging.doc.kerberos.live/prologue/introduction/>Introduction</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/prologue/how/>How it works</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/prologue/deployments/>Deployments</a></li></ul><h3>Opensource v2</h3><ul class=list-unstyled><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/first-things-first/>First things first</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/get-started/>Get started</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/installation/>Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/installation-advanced/>Advanced Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/releases/>Release notes</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/license/>License</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/upgrade/>Upgrade</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/contribute/>Contribute</a></li><li><a class="docs-link active" href=https://staging.doc.kerberos.live/opensource/machinery/>Machinery</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/opensource/web/>Web</a></li></ul><h3>Opensource v3</h3><ul class=list-unstyled><li><a class=docs-link href=https://staging.doc.kerberos.live/opensourcev3/announcement/>Announcement</a></li></ul><h3>Enterprise</h3><ul class=list-unstyled><li><a class=docs-link href=https://staging.doc.kerberos.live/enterprise/first-things-first/>First things first</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/enterprise/get-started/>Get Started</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/enterprise/installation/>Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/enterprise/installation-cloud/>Cloud Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/enterprise/installation-edge/>Edge Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/enterprise/releases/>Releases</a></li></ul><h3>Vault</h3><ul class=list-unstyled><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/first-things-first/>First things first</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/get-started/>Get Started</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/installation/>Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/installation-cloud/>Cloud Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/installation-edge/>Edge Installation</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/providers/>Providers</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/recycle/>Recycle</a></li><li><a class=docs-link href=https://staging.doc.kerberos.live/vault/releases/releases/>Releases</a></li></ul><h3>Hub</h3><ul class=list-unstyled><li><a class=docs-link href=https://staging.doc.kerberos.live/hub/first-things-first/>First things first</a></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#project-structure>Project structure</a></li><li><a href=#capture>Capture</a><ul><li><a href=#usb-camera>USB camera</a></li><li><a href=#raspberry-pi-camera-module>Raspberry Pi Camera Module</a></li><li><a href=#ip-camera>IP camera</a></li></ul></li><li><a href=#condition>Condition</a><ul><li><a href=#enabled>Enabled</a></li><li><a href=#time>Time</a></li></ul></li><li><a href=#algorithm>Algorithm</a><ul><li><a href=#differential-images>Differential images</a></li></ul></li><li><a href=#expositor>Expositor</a><ul><li><a href=#rectangle>Rectangle</a></li><li><a href=#hull>Hull</a></li></ul></li><li><a href=#heuristic>Heuristic</a><ul><li><a href=#sequence>Sequence</a></li></ul></li><li><a href=#output>Output</a><ul><li><a href=#disk>Disk</a></li><li><a href=#video>Video</a></li><li><a href=#tcpip-client>TCP/IP client</a></li><li><a href=#gpio>GPIO</a></li><li><a href=#webhook>Webhook</a></li><li><a href=#script>Script</a></li><li><a href=#mqtt>MQTT</a></li></ul></li><li><a href=#streaming>Streaming</a><ul><li><a href=#parameters-16>Parameters</a></li></ul></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Machinery</h1><p class=lead></p><p>The machinery is the processing engine of Kerberos Open Source. It&rsquo;s an image processing framework, written in C++, who benefits from other third party libraries (OpenCV, etc). It takes images from the type of camera (USB-, IP- or RPi-camera) you&rsquo;ve configured in the configuration files and executes one ore more algorithms and post-processes (e.g. save a snapshot). The configuration files allow you to define the type of camera, post-processes, conditions and much more; it&rsquo;s highly configurable. It&rsquo;s important to note that the machinery, out-of-the-box, can handle only one camera at a time.</p><h2 id=project-structure>Project structure<a href=#project-structure class=anchor aria-hidden=true>#</a></h2><p>The machinery is an image processing framework which is devided into four steps:</p><ul><li>condition</li><li>algorithm</li><li>expositor</li><li>heuristic</li></ul><p>The steps belong to a four passway; illustrated on the image below. In each cycle a sequence of images is processed. Each step will process the sequence, and will return some result to the next step. For example: an algorithm will process the images and returns an array to the Expositor, which contains boolean values. The steps are loosly coupled, so they have simple conventions, just like the example before.</p><p>Thanks to the loosly coupling, each step can be developed indepently. So algorithms, expositors, heuristics and conditions can be switched on the fly. This makes it easier for other developers who want to contribute to the machinery. They can create a new algorithm without knowing how a specific expositor or heuristic works. They just need to be aware of the convention an algorithm should meet.</p><figure class=stretch><img src=project-structure.svg alt="The Kerberos Opensource agent is composed out of different concepts."><figcaption><p>The Kerberos Opensource agent is composed out of different concepts.</p></figcaption></figure><p>These different steps can be configured by editing a couple of configurationn files located at <code>config/</code>. The main configuration file <code>config/config.xml</code> looks like this:</p><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;kerberos&gt;
  &lt;instance&gt;
    &lt;name type=&quot;text&quot;&gt;frontdoor&lt;/name&gt;
    &lt;logging type=&quot;bool&quot;&gt;false&lt;/logging&gt;
    &lt;timezone type=&quot;timezone&quot;&gt;Europe-Brussels&lt;/timezone&gt;
    &lt;capture file=&quot;capture.xml&quot;&gt;RaspiCamera&lt;/capture&gt;
    &lt;stream file=&quot;stream.xml&quot;&gt;Mjpg&lt;/stream&gt;
    &lt;condition file=&quot;condition.xml&quot; type=&quot;multiple&quot;&gt;Enabled&lt;/condition&gt;
    &lt;algorithm file=&quot;algorithm.xml&quot;&gt;DifferentialCollins&lt;/algorithm&gt;
    &lt;expositor file=&quot;expositor.xml&quot;&gt;Hull&lt;/expositor&gt;
    &lt;heuristic file=&quot;heuristic.xml&quot;&gt;Sequence&lt;/heuristic&gt;
    &lt;io file=&quot;io.xml&quot; type=&quot;multiple&quot;&gt;Video&lt;/io&gt;
    &lt;cloud file=&quot;cloud.xml&quot;&gt;S3&lt;/cloud&gt;
  &lt;/instance&gt;
&lt;/kerberos&gt;
</code></pre><h2 id=capture>Capture<a href=#capture class=anchor aria-hidden=true>#</a></h2><p>You can choose which capture device you will be using, you can use your old USB webcam, the popular Raspberry Pi camera or a state-of-the-art IP camera. The capture device will take pictures and deliver them to the algorithm if the conditions (the first step of the four passway) are valid.</p><p>You can change the capture device by changing the <code>config/config.xml</code> file, and choose one of the following:</p><ul><li>USBCamera</li><li>RaspiCamera</li><li>IPCamera</li></ul><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;kerberos&gt;
  &lt;instance&gt;
    ...
    &lt;capture file=&quot;capture.xml&quot;&gt;RaspiCamera&lt;/capture&gt;
    ...
  &lt;/instance&gt;
&lt;/kerberos&gt;
</code></pre><h3 id=usb-camera>USB camera<a href=#usb-camera class=anchor aria-hidden=true>#</a></h3><p>The machinery supports a whole range of USB cameras. You will find a complete list here. Make sure you have updated the web interface, to make the machinery aware you will be using an USB camera.</p><h4 id=parameters>Parameters<a href=#parameters class=anchor aria-hidden=true>#</a></h4><p>The parameters of the USB camera can be found in the <code>config/capture.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;captures&gt;
  &lt;USBCamera&gt;
    &lt;frameWidth type=&quot;number&quot;&gt;1280&lt;/frameWidth&gt;
    &lt;frameHeight type=&quot;number&quot;&gt;720&lt;/frameHeight&gt;
    &lt;deviceNumber type=&quot;number&quot;&gt;0&lt;/deviceNumber&gt;
    &lt;delay type=&quot;number&quot;&gt;0&lt;/delay&gt;
    &lt;angle type=&quot;number&quot;&gt;0&lt;/angle&gt;
  &lt;/USBCamera&gt;
&lt;/captures&gt;
</code></pre><h5 id=framewidth-and--height>Framewidth and -height<a href=#framewidth-and--height class=anchor aria-hidden=true>#</a></h5><p>You can set the resolution of the capture device, make sure the resolution you&rsquo;ve defined is valid with your camera. Please check the specs of the USB camera you&rsquo;re using.</p><h5 id=device-number>Device number<a href=#device-number class=anchor aria-hidden=true>#</a></h5><p>If more than one device is connected, you can specify the index of the USB-camera. The index is an integer (1-5).</p><h5 id=delay>Delay<a href=#delay class=anchor aria-hidden=true>#</a></h5><p>You can provide a delay/interval (milliseconds) between two captures.</p><h5 id=angle>Angle<a href=#angle class=anchor aria-hidden=true>#</a></h5><p>By defining an angle (degrees), you can rotate the images taken by the capture device. For example if you would mount the camera upside down, than you could enter the value 180 as the angle; this will flip the images.</p><h3 id=raspberry-pi-camera-module>Raspberry Pi Camera Module<a href=#raspberry-pi-camera-module class=anchor aria-hidden=true>#</a></h3><p>You can use the Raspberry Pi Camera Module with the machinery. You just need to attach the camera module and you&rsquo;re ready to go. The Raspberry Pi Camera Module is enabled by default in the web.</p><h4 id=parameters-1>Parameters<a href=#parameters-1 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Raspberry Pi Camera Module can be found in the config/capture.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;captures&gt;
  &lt;RaspiCamera&gt;
    &lt;frameWidth type=&quot;number&quot;&gt;640&lt;/frameWidth&gt;
    &lt;frameHeight type=&quot;number&quot;&gt;480&lt;/frameHeight&gt;
    &lt;delay type=&quot;number&quot;&gt;1400&lt;/delay&gt;
    &lt;angle type=&quot;number&quot;&gt;0&lt;/angle&gt;
    &lt;framerate type=&quot;number&quot;&gt;30&lt;/framerate&gt;
    &lt;sharpness type=&quot;number&quot;&gt;0&lt;/sharpness&gt;
    &lt;saturation type=&quot;number&quot;&gt;0&lt;/saturation&gt;
    &lt;contrast type=&quot;number&quot;&gt;0&lt;/contrast&gt;
    &lt;brightness type=&quot;number&quot;&gt;50&lt;/brightness&gt;
  &lt;/RaspiCamera&gt;
&lt;/captures&gt;
</code></pre><h5 id=framewidth-and--height-1>Framewidth and -height<a href=#framewidth-and--height-1 class=anchor aria-hidden=true>#</a></h5><p>You can set the resolution of the camera module, make sure the resolution you&rsquo;ve defined is valid.</p><h5 id=delay-1>Delay<a href=#delay-1 class=anchor aria-hidden=true>#</a></h5><p>You can provide a delay/interval (milliseconds) between two captures.</p><h5 id=angle-1>Angle<a href=#angle-1 class=anchor aria-hidden=true>#</a></h5><p>By defining an angle (degrees), you can rotate the images taken by the capture device. For example if you would mount the camera upside down, than you could enter the value 180 as the angle; this will flip the images.</p><h5 id=framerate>Framerate<a href=#framerate class=anchor aria-hidden=true>#</a></h5><p>The number of frames captures per second. Please note that this parameter will also be used if you&rsquo;re recording video. E.g. if you set this parameter to 20, you&rsquo;re recorded videos will also be 20 FPS.</p><h5 id=sharpness-saturation-contrast-brightness>Sharpness, saturation, contrast, brightness<a href=#sharpness-saturation-contrast-brightness class=anchor aria-hidden=true>#</a></h5><p>Camera properties which you can specify to tune the settings to your needs.</p><h3 id=ip-camera>IP camera<a href=#ip-camera class=anchor aria-hidden=true>#</a></h3><p>The machinery can be used with any IP camera, that provides a RTSP (or MJPEG) stream. Make sure that you know the correct URL of your IP camera, you can <a href=http://www.ispyconnect.com/sources.aspx>find a list here</a>.</p><h4 id=parameters-2>Parameters<a href=#parameters-2 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the IP capture device can be found in the <code>config/capture.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;captures&gt;
  &lt;IPCamera&gt;
    &lt;url type=&quot;text&quot;&gt;http://username:password@ipaddress/image.jpg&lt;/url&gt;
    &lt;frameWidth type=&quot;number&quot;&gt;800&lt;/frameWidth&gt;
    &lt;frameHeight type=&quot;number&quot;&gt;640&lt;/frameHeight&gt;
    &lt;delay type=&quot;number&quot;&gt;0&lt;/delay&gt;
    &lt;angle type=&quot;number&quot;&gt;0&lt;/angle&gt;
  &lt;/IPCamera&gt;
&lt;/captures&gt;
</code></pre><h5 id=url>URL<a href=#url class=anchor aria-hidden=true>#</a></h5><p>To use your IP camera, you should provide a valid RTSP (or MJPEG) URL. The machinery will take snapshots from this stream.</p><h5 id=framewidth-and--height-2>Framewidth and -height<a href=#framewidth-and--height-2 class=anchor aria-hidden=true>#</a></h5><p>You can set the resolution of the capture device, make sure the resolution you&rsquo;ve defined is equal to the resolution you&rsquo;ve defined in your IP-camera software.</p><h5 id=delay-2>Delay<a href=#delay-2 class=anchor aria-hidden=true>#</a></h5><p>You can provide a delay/interval (milliseconds) between two captures.</p><h5 id=angle-2>Angle<a href=#angle-2 class=anchor aria-hidden=true>#</a></h5><p>By defining an angle (degrees), you can rotate the images taken by the capture device. For example if you would mount the camera upside down, than you could enter the value 180 as the angle; this will flip the images.</p><h2 id=condition>Condition<a href=#condition class=anchor aria-hidden=true>#</a></h2><p>The condition is the first step of the four passway. In this step the machinery will determine if it&rsquo;s allowed to proceed to the next step. For example a condition can be a time constraint, a brightness threshold, etc; multiple conditions can be selected.</p><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;kerberos&gt;
  &lt;instance&gt;
    ...
    &lt;condition file=&quot;condition.xml&quot; type=&quot;multiple&quot;&gt;Enabled&lt;/condition&gt;
    ...
  &lt;/instance&gt;
&lt;/kerberos&gt;
</code></pre><h3 id=enabled>Enabled<a href=#enabled class=anchor aria-hidden=true>#</a></h3><p>It can be helpful to enable or disable the machinery at specific times. Therefore the time condition makes it possible to select a time range for each day of the week. When the current time is within the time range, the machinery will be enabled.</p><h4 id=parameters-3>Parameters<a href=#parameters-3 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Enabled condition can be found in the <code>config/condition.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;conditions&gt;
  &lt;Enabled&gt;
    &lt;active type=&quot;bool&quot;&gt;true&lt;/active&gt;
    &lt;delay type=&quot;number&quot;&gt;5000&lt;/delay&gt;
  &lt;/Enabled&gt;
&lt;/conditions&gt;
</code></pre><h5 id=active>Active<a href=#active class=anchor aria-hidden=true>#</a></h5><p>The active field is boolean value (true/false). When the active field is true, the machinery is enabled, if not it&rsquo;s disabled.</p><h5 id=delay-3>Delay<a href=#delay-3 class=anchor aria-hidden=true>#</a></h5><p>The delay value is used when the condition failed, so when the current time isn&rsquo;t in the selected time range for that day. In that case the machinery will idle for the specified delay time. The value of the delay is expressed in miliseconds.</p><h3 id=time>Time<a href=#time class=anchor aria-hidden=true>#</a></h3><p>It can be helpful to enable or disable the machinery at specific times. Therefore the time condition makes it possible to select a time range for each day of the week. When the current time is within the time range, the machinery will be enabled.</p><h4 id=parameters-4>Parameters<a href=#parameters-4 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Time condition can be found in the <code>config/condition.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;conditions&gt;
  &lt;Time&gt;
    &lt;times type=&quot;timeselection&quot;&gt;13:00,15:00-0:01,20:58-0:01,20:59-0:01,19:20-0:01,21:59-0,0-0,0&lt;/times&gt;
    &lt;delay type=&quot;number&quot;&gt;10000&lt;/delay&gt;
  &lt;/Time&gt;
&lt;/conditions&gt;
</code></pre><h5 id=times>Times<a href=#times class=anchor aria-hidden=true>#</a></h5><p>The times property contains a list of times, delimited by a &ldquo;-&rdquo;. The first item in the list will specify the time range for the first day of the week (Monday), the last item for the last day of the week (Sunday). The begin- and end-time, for a specific day, are delimited by a &ldquo;,&rdquo; where the first element will specify that start time and the second one specifies the end time.</p><h5 id=delay-4>Delay<a href=#delay-4 class=anchor aria-hidden=true>#</a></h5><p>The delay value is used when the condition failed, so when the current time isn&rsquo;t in the selected time range for that day. In that case the machinery will idle for the specified delay time. The value of the delay is expressed in miliseconds.</p><h2 id=algorithm>Algorithm<a href=#algorithm class=anchor aria-hidden=true>#</a></h2><p>The algorithm is the second step of the four passway. An algorithm will execute some kind of function on a sequence of images, and end up with a black and white image; just like the image below. An example of an algorithm would be one that does motion detection or one that would detect cats or dogs (using TensorFlow, ar any other Deep Learning framework).</p><figure class=stretch><img src=algorithm.png alt="An algorithm allows us to find the pixels of interests."><figcaption><p>An algorithm allows us to find the pixels of interests.</p></figcaption></figure><p>The white pixels on the image will indicate the object of interest. For example, when looking for motion, the pixels that have been changed; it depends on what the algorithm is looking for. The black pixels are background pixels.</p><p>The only convention that an algorithm should meet is that it should return a black and white image to the next step; the expositor. And of course that it requires a sequence of images as a parameter. Besides those conventions, an algorithm can do everything it wants to do. So you could create your own cat detection algorithm, marker detection, etc.</p><p>You can select the algortihm in the <code>config/config.xml</code>.</p><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;kerberos&gt;
  &lt;instance&gt;
    ...
    &lt;algorithm file=&quot;algorithm.xml&quot;&gt;DifferentialCollins&lt;/algorithm&gt;
    ...
  &lt;/instance&gt;
&lt;/kerberos&gt;
</code></pre><h3 id=differential-images>Differential images<a href=#differential-images class=anchor aria-hidden=true>#</a></h3><p>This algorithm is a very simple method to detect motion; in terms of understanding but also processing. Just like the name says, it&rsquo;s the result of comparing images. When the images are compared, we know the pixels that have been changed and if the amount of pixels that changed is big enough, one can say that something happened and thus motion was detected.</p><p>To get a more technical explanation: the algoritm will substract 2 or more images, and once that is done it will end up with a black and white image. The white pixels will mark the pixels that where different/changed and the black pixels are the pixels that have not changed; background pixels. Please note that there are several different combinations of substracting images. However for the machinery, we will use the method of Collins et al. as this method erases the phenomenon &ldquo;ghosting&rdquo;.</p><figure class=stretch><img src=differential-images.png alt="The differential images algorithm takes a sequence of images to calculate motion."><figcaption><p>The differential images algorithm takes a sequence of images to calculate motion.</p></figcaption></figure><p>In the image above the method of Collins et al. is illustrated. For this method we will process three images. The images are a sequence (from left to right), so the first (A) image was taken before the second (B) one, and the second (B) before the third (C) one. Next we will do a first comparision (C-B) of the third (C) image and the second (B) image, and after that we will do a second comparison (C-A) of the third (C) image and first (A) image.</p><p>After the comparison we will end up with two difference images (C-B) and (C-A); both will mark the white pixels as changed pixels and black as non-changed pixels. To finish the algorithm we will do a logical AND-operation of the two difference images; this will give us the final black and white image ((C-B)&&(C-A)).</p><p>The main idea of the Colins et al. method, is that it will erase &ldquo;ghosting&rdquo;. In the last step we are doing a logical AND-operation, by doing this we will only keep the pixels, that changed in the first two images; therefore we can eliminate false positives.</p><h4 id=parameters-5>Parameters<a href=#parameters-5 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Differential images algorithm can be found in the config/algorithm.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;algorithms&gt;
  &lt;DifferentialCollins&gt;
    &lt;erode type=&quot;number&quot;&gt;5&lt;/erode&gt;
    &lt;threshold type=&quot;number&quot;&gt;20&lt;/threshold&gt;
  &lt;/DifferentialCollins&gt;
&lt;/algorithms&gt;
</code></pre><h5 id=erode>Erode<a href=#erode class=anchor aria-hidden=true>#</a></h5><p>The erode parameter represents a structural element (a morphological operation), which will be used to minimize the changed pixels; more information about eroding can be found here. The idea of the eroding is that pixels which are isolated will be removed; this means that when only one pixel changed, that pixel will reverted to the non-changed state. But for example when a large change happens and a lot of adjacent pixels are changed, the eroding will not be able to revert them.</p><p>The higher the number of the erode parameter, the more aggressive the eroding will be. So high erode values, will make it possible that also large changes will be reverted to the non-changed state.</p><h5 id=threshold>Threshold<a href=#threshold class=anchor aria-hidden=true>#</a></h5><p>When doing the comparison of two images, we won&rsquo;t end up with a clean black and white image. In most of the cases the values will be between 0 and 255; so gray values. This means that the value 0 will mean that both pixels where the same in both image, and values 255 mean that both pixels where totally different in both images. Of course we will also have values between 0-255, so pixels that are a little bit different in both images. So to make the resulting black and white image, we will need to apply a threshold value.</p><p>The threshold will specify how much a pixel has to be different in the two images. So for example when the threshold is 30, it means that the difference between two pixels has to be equal or more then 30. The higher the threshold the more the pixel needs to be different, to be marked as changed.</p><h2 id=expositor>Expositor<a href=#expositor class=anchor aria-hidden=true>#</a></h2><p>After the algorithm is executed, the expositor will determine, a region, where the changes were detected. An expositor can constrain a region in terms of selecting a hull or defining a rectangle.</p><p>An expositor receives a black and white image as parameter and should modify a JSON object with all the information it processed. The JSON object must include: the bounding rectangle(s) of the positions where the pixels of interest are located and the number of pixels of interest. But can also include other optional parameters.</p><p>You can change the expositor by changing the <code>config/config.xml</code> file, and choose one of the following:</p><ul><li>Hull</li><li>Rectangle</li></ul><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;kerberos&gt;
  &lt;instance&gt;
    ...
    &lt;expositor file=&quot;expositor.xml&quot;&gt;Hull&lt;/expositor&gt;
    ...
  &lt;/instance&gt;
&lt;/kerberos&gt;
</code></pre><h3 id=rectangle>Rectangle<a href=#rectangle class=anchor aria-hidden=true>#</a></h3><p>This is a trivial expositor. A rectangle region can be defined to constrain the locations of pixels of interest. The rectangle repositor will return the region of the pixels of interest.</p><h4 id=parameters-6>Parameters<a href=#parameters-6 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the rectangle expositor can be found in the config/expositor.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;expositors&gt;
  &lt;Rectangle&gt;
    &lt;region&gt;
      &lt;x1 type=&quot;number&quot;&gt;0&lt;/x1&gt;
      &lt;y1 type=&quot;number&quot;&gt;0&lt;/y1&gt;
      &lt;x2 type=&quot;number&quot;&gt;1280&lt;/x2&gt;
      &lt;y2 type=&quot;number&quot;&gt;720&lt;/y2&gt;
    &lt;/region&gt;
  &lt;/Rectangle&gt;
&lt;/expositors&gt;
</code></pre><h5 id=region>Region<a href=#region class=anchor aria-hidden=true>#</a></h5><p>The region parameter contains 4 values; x1, y1, x2 and y2 respectively. The values x1 and y1 indicate the x- and y-coordinate of the left upper starting point. The values x2 and y2 are the bottom right coordinates. A virtual rectangle will be drawn from (x1,y1) to (x2,y2). Pixels of interest that lie within this rectangle are valid pixels; if not they are invalid.</p><h3 id=hull>Hull<a href=#hull class=anchor aria-hidden=true>#</a></h3><p>This hull is a more complex expositor than the rectangle. A hull can be selected with the web, you can select one or more coordinates to create a flexible region. The coordinates can be adjusted afterwards and be removed by double clicking on the coordinate. You can expand the hull by removing the start coordinate, which is marked by the white bullet.</p><figure class=stretch><img src=hull.png alt="A hull, or polygon, allows you to specify a region of interest."><figcaption><p>A hull, or polygon, allows you to specify a region of interest.</p></figcaption></figure><h4 id=parameters-7>Parameters<a href=#parameters-7 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the hull expositor can be found in the config/expositor.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;expositors&gt;
  &lt;Hull&gt;
    &lt;region type=&quot;hullselection&quot;&gt;347,361|627,266|975,328|1091,328|1148,413|1158,516|1121,534|962,567|699,648|531,700|243,613|423,550|665,453|850,470|666,361|467,385|325,460|165,372&lt;/region&gt;
  &lt;/Hull&gt;
&lt;/expositors&gt;
</code></pre><h5 id=region-1>Region<a href=#region-1 class=anchor aria-hidden=true>#</a></h5><p>The region parameter contains n values. Each value represents a coordinate (x,y) and are seperated by the &ldquo;|&rdquo; delimiter. These coordinates are used to calculate the concave hull. Pixels of interest that lie within the concave hull are valid pixels; if not they are invalid.</p><h2 id=heuristic>Heuristic<a href=#heuristic class=anchor aria-hidden=true>#</a></h2><p>The heuristic is the last step in the four passway which will decide if the detection is valid or not. It will do this by using information from the previous steps (the expositor and the algorithm); e.g. number of changed pixels.</p><p>You can change the heuristic by changing the <code>config/config.xml</code> file, and choose one of the following:</p><ul><li>Sequence</li></ul><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;kerberos&gt;
  &lt;instance&gt;
    ...
    &lt;heuristic file=&quot;heuristic.xml&quot;&gt;Sequence&lt;/heuristic&gt;
    ...
  &lt;/instance&gt;
&lt;/kerberos&gt;
</code></pre><h3 id=sequence>Sequence<a href=#sequence class=anchor aria-hidden=true>#</a></h3><p>This is a trivial heuristic. The sequence heuristic will store a single integer in memory, that will count the numbers of valid detections. When the heuristic will detect a false detection, it will decrease the count. The sequence heuristic will return true, if a threshold is reached; for example when something was detected three times in a row.</p><h4 id=parameters-8>Parameters<a href=#parameters-8 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Sequence heuristic can be found in the config/heuristic.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;heuristics&gt;
&lt;Sequence&gt;
    &lt;minimumChanges type=&quot;number&quot;&gt;1&lt;/minimumChanges&gt;
    &lt;minimumDuration type=&quot;number&quot;&gt;1&lt;/minimumDuration&gt;
    &lt;noMotionDelayTime type=&quot;number&quot;&gt;2000&lt;/noMotionDelayTime&gt;
  &lt;/Sequence&gt;
&lt;/heuristics&gt;
</code></pre><h5 id=minimum-changes>Minimum changes<a href=#minimum-changes class=anchor aria-hidden=true>#</a></h5><p>The heuristic will only return true if enough changes have been detected. The minimum of changes indicates the minimum number of pixels that have to been changed, to be a valid detection.</p><h5 id=minimum-durations>Minimum durations<a href=#minimum-durations class=anchor aria-hidden=true>#</a></h5><p>The minimum number of detections in a row to be a valid detection.</p><h5 id=no-motion-delay-time>No motion delay time<a href=#no-motion-delay-time class=anchor aria-hidden=true>#</a></h5><p>When the heuristic failed, due to not enough pixels changed or not x detections in a row, the heuristic will idle for some time.</p><h2 id=output>Output<a href=#output class=anchor aria-hidden=true>#</a></h2><p>If the heuristic determined that the evaluation was valid, one or more output operations can be executed. You configure which ooutput operations that will be executed, by modifying the configuration file or using the web interface.</p><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;kerberos&gt;
  &lt;instance&gt;
    ...
    &lt;io file=&quot;io.xml&quot; type=&quot;multiple&quot;&gt;Video&lt;/io&gt;
    ...
  &lt;/instance&gt;
&lt;/kerberos&gt;
</code></pre><p>You can choose which output devices you will be using. If you select multiple outputs, seperate them with an <code>,</code>. You can change the output device by changing the <code>config/config.xml</code> file, and choose one of the following:</p><ul><li>Disk</li><li>Video</li><li>GPIO</li><li>TCPSocket</li><li>Webhook</li><li>MQTT</li><li>Script</li></ul><h3 id=disk>Disk<a href=#disk class=anchor aria-hidden=true>#</a></h3><p>An image can be saved to disk.</p><h4 id=parameters-9>Parameters<a href=#parameters-9 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Disk output device can be found in the <code>config/io.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;ios&gt;
  &lt;Disk&gt;
    &lt;fileFormat type=&quot;text&quot;&gt;timestamp_microseconds_instanceName_regionCoordinates_numberOfChanges_token.jpg&lt;/fileFormat&gt;
    &lt;directory type=&quot;text&quot;&gt;/etc/opt/kerberosio/capture/&lt;/directory&gt;
    &lt;markWithTimestamp type=&quot;bool&quot;&gt;false&lt;/markWithTimestamp&gt;
    &lt;timestampColor type=&quot;text&quot;&gt;white&lt;/timestampColor&gt;
    &lt;privacy type=&quot;bool&quot;&gt;false&lt;/privacy&gt;
    &lt;throttler type=&quot;number&quot;&gt;0&lt;/throttler&gt;
  &lt;/Disk&gt;
&lt;/ios&gt;
</code></pre><h5 id=file-format>File format<a href=#file-format class=anchor aria-hidden=true>#</a></h5><p>The format that will be used for the name of the image. One or more variables can be defined and will be replaced by the machinery. Note that when you&rsquo;re using a variables name in the file format, that this name should be defined in the JSON object.</p><h5 id=directory>Directory<a href=#directory class=anchor aria-hidden=true>#</a></h5><p>The directory where the image will be saved to. By default images are saved to the /etc/opt/kerberosio/capture directory.</p><h5 id=mark-with-timestamp>Mark with timestamp<a href=#mark-with-timestamp class=anchor aria-hidden=true>#</a></h5><p>When this settings is set to true, the image is marked with a timestamp.</p><h5 id=timestamp-color>Timestamp color<a href=#timestamp-color class=anchor aria-hidden=true>#</a></h5><p>A color can be defined for timestamp: white, black, red, green and blue.</p><h5 id=privacy>Privacy<a href=#privacy class=anchor aria-hidden=true>#</a></h5><p>The privacy mode can be activated to remove some parts from the image. This especially helpful if you want to filter out public areas. When this option is enabled you will seee that after configuring the Hull expositor, you&rsquo;ll see that the pixels outside your region of interest (Hull) are made black.</p><h5 id=throttler>Throttler<a href=#throttler class=anchor aria-hidden=true>#</a></h5><p>Control the number of executions by setting a throttling value. E.g. if you set throttling to 5, the Disk will only be triggered once in 5 seconds, nevertheless more detections occurred.</p><h3 id=video>Video<a href=#video class=anchor aria-hidden=true>#</a></h3><p>When a valid event is detected, a video will be recorded for x seconds. When more valid events are detected, while a video is recording, the video file will further record for x seconds; so no new video file be recorded, but the existing one will be expanded.</p><h4 id=parameters-10>Parameters<a href=#parameters-10 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Video output device can be found in the <code>config/io.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;ios&gt;
  &lt;Video&gt;
    &lt;fps type=&quot;number&quot;&gt;3&lt;/fps&gt;
    &lt;recordAfter type=&quot;number&quot;&gt;5&lt;/recordAfter&gt;
    &lt;maxDuration type=&quot;number&quot;&gt;120&lt;/maxDuration&gt;
    &lt;extension type=&quot;number&quot;&gt;mp4&lt;/extension&gt;
    &lt;codec type=&quot;number&quot;&gt;h264&lt;/codec&gt;
    &lt;fileFormat type=&quot;text&quot;&gt;timestamp_microseconds_instanceName_regionCoordinates_numberOfChanges_token&lt;/fileFormat&gt;
    &lt;directory type=&quot;text&quot;&gt;/etc/opt/kerberosio/capture/&lt;/directory&gt;
    &lt;hardwareDirectory type=&quot;text&quot;&gt;/etc/opt/kerberosio/h264/&lt;/hardwareDirectory&gt;
    &lt;enableHardwareEncoding type=&quot;bool&quot;&gt;true&lt;/enableHardwareEncoding&gt;
    &lt;markWithTimestamp type=&quot;bool&quot;&gt;false&lt;/markWithTimestamp&gt;
    &lt;timestampColor type=&quot;text&quot;&gt;white&lt;/timestampColor&gt;
    &lt;privacy type=&quot;bool&quot;&gt;false&lt;/privacy&gt;
    &lt;throttler type=&quot;number&quot;&gt;0&lt;/throttler&gt;
  &lt;/Video&gt;
&lt;/ios&gt;
</code></pre><h5 id=fps>FPS<a href=#fps class=anchor aria-hidden=true>#</a></h5><p>The frames per second of the video being recorded. Please note that this number is limited and depends heavily on your hardware setup. You&rsquo;ll be receiving following warning in the systems logs, if the machinery can&rsquo;t write the desired FPS.</p><pre><code class=language-text>[trivial] IoVideo: framerate is too fast, can't record video at this speed (8/FPS)
</code></pre><h5 id=record-after>Record after<a href=#record-after class=anchor aria-hidden=true>#</a></h5><p>The number of seconds recorded after the last valid event was detected. This means that when a video is already recording, and a valid event was detected, the video will be expanded with x more seconds.</p><h5 id=extensions>Extensions<a href=#extensions class=anchor aria-hidden=true>#</a></h5><p>The extension or container of the video file. We highly recommend to use the MP4 container if you want cross-browser support. Leave this setting by default, if you don&rsquo;t know what you&rsquo;re doing.</p><h5 id=codec>Codec<a href=#codec class=anchor aria-hidden=true>#</a></h5><p>The codec that is used to encode the video file.</p><h5 id=file-format-1>File format<a href=#file-format-1 class=anchor aria-hidden=true>#</a></h5><p>The format that will be used for the name of the image. One or more variables can be defined and will be replaced by the machinery. Note that when you&rsquo;re using a variables name in the file format, that this name should be defined in the JSON object.</p><h5 id=directory-1>Directory<a href=#directory-1 class=anchor aria-hidden=true>#</a></h5><p>The directory where the videos will be saved. By default videos are saved to the /etc/opt/kerberosio/capture directory.</p><h5 id=hardware-directory>Hardware directory<a href=#hardware-directory class=anchor aria-hidden=true>#</a></h5><p>When using onboard hardware encoding (e.g. with Raspberry Pi camera), h264 video files are generated and stored in this directory. Afterwards these h264 files will be containerized to mp4 files, and stored in the Directory path.</p><h5 id=enable-hardware-encoding>Enable Hardware encoding<a href=#enable-hardware-encoding class=anchor aria-hidden=true>#</a></h5><p>A boolean which can enable or disable hardware encoding. Please note that this option is enabled by default, but does not mean that it will work if you choose to use an USB camera.</p><h5 id=mark-with-timestamp-1>Mark with timestamp<a href=#mark-with-timestamp-1 class=anchor aria-hidden=true>#</a></h5><p>When this settings is set to true, the video is marked with a timestamp (similar to the Disk device).</p><h5 id=timestamp-color-1>Timestamp color<a href=#timestamp-color-1 class=anchor aria-hidden=true>#</a></h5><p>A color can be defined for timestamp: white, black, red, green and blue.</p><h5 id=privacy-1>Privacy<a href=#privacy-1 class=anchor aria-hidden=true>#</a></h5><p>The privacy mode can be activated to remove some parts from the video. This especially helpful if you want to filter out public areas.</p><h5 id=video-privacy>Video privacy<a href=#video-privacy class=anchor aria-hidden=true>#</a></h5><p>After updating the configuration, you&rsquo;ll see that the pixels outside your region of interest (ROI) are made black; the image below illustrates this.</p><h5 id=throttler-1>Throttler<a href=#throttler-1 class=anchor aria-hidden=true>#</a></h5><p>Control the number of executions by setting a throttling value. E.g. if you set throttling to 5, the Video will only be triggered once in 5 seconds, nevertheless more detections occurred.</p><h3 id=tcpip-client>TCP/IP client<a href=#tcpip-client class=anchor aria-hidden=true>#</a></h3><p>The TCP/IP client will send a TCP packet to a server.</p><h4 id=parameters-11>Parameters<a href=#parameters-11 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the TCP/IP client can be found in the config/io.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;ios&gt;
  &lt;TCPSocket&gt;
    &lt;server type=&quot;number&quot;&gt;127.0.0.1&lt;/server&gt;
    &lt;port type=&quot;number&quot;&gt;1337&lt;/port&gt;
    &lt;message type=&quot;text&quot;&gt;it's so fluffy&lt;/message&gt;
    &lt;throttler type=&quot;number&quot;&gt;0&lt;/throttler&gt;
  &lt;/TCPSocket&gt;
&lt;/ios&gt;
</code></pre><h5 id=server>Server<a href=#server class=anchor aria-hidden=true>#</a></h5><p>The IP of the TCP server.</p><h5 id=port>Port<a href=#port class=anchor aria-hidden=true>#</a></h5><p>This is the port of the TCP server.</p><h5 id=message>Message<a href=#message class=anchor aria-hidden=true>#</a></h5><p>You can send some data to a TCP server.</p><h5 id=throttler-2>Throttler<a href=#throttler-2 class=anchor aria-hidden=true>#</a></h5><p>Control the number of executions by setting a throttling value. E.g. if you set throttling to 5, the TCP will only be triggered once in 5 seconds, nevertheless more detections occurred.</p><h3 id=gpio>GPIO<a href=#gpio class=anchor aria-hidden=true>#</a></h3><p>A GPIO pin can be set as output device.</p><h4 id=parameters-12>Parameters<a href=#parameters-12 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the GPIO pin can be found in the <code>config/io.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;ios&gt;
  &lt;GPIO&gt;
    &lt;pin type=&quot;number&quot;&gt;17&lt;/pin&gt;
    &lt;periods type=&quot;number&quot;&gt;5&lt;/periods&gt;
    &lt;periodTime type=&quot;number&quot;&gt;100000&lt;/periodTime&gt;
    &lt;throttler type=&quot;number&quot;&gt;0&lt;/throttler&gt;
  &lt;/GPIO&gt;
&lt;/ios&gt;
</code></pre><h5 id=pin>Pin<a href=#pin class=anchor aria-hidden=true>#</a></h5><p>The pin that will be triggered.</p><h5 id=periods>Periods<a href=#periods class=anchor aria-hidden=true>#</a></h5><p>The number of times the pin will be triggered.</p><h5 id=period-time>Period time<a href=#period-time class=anchor aria-hidden=true>#</a></h5><p>The time in microseconds that the pin will be set high.</p><h5 id=throttler-3>Throttler<a href=#throttler-3 class=anchor aria-hidden=true>#</a></h5><p>Control the number of executions by setting a throttling value. E.g. if you set throttling to 5, the GPIO will only be triggered once in 5 seconds, nevertheless more detections occurred.</p><h3 id=webhook>Webhook<a href=#webhook class=anchor aria-hidden=true>#</a></h3><p>Detailed information (a JSON object) is send as a POST request to a webhook. The JSON object contains the number of changes, the region, the URL of the image, etc. This is useful if you want to integrate with your own application.</p><p>Make sure that the Webhook comes after the Disk device, otherwise the URL of the image is not included.</p><h4 id=parameters-13>Parameters<a href=#parameters-13 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the webhook can be found in the config/io.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;ios&gt;
  &lt;Webhook&gt;
    &lt;url type=&quot;text&quot;&gt;http://kerberos.web/api/v1/webhook&lt;/url&gt;
    &lt;throttler type=&quot;number&quot;&gt;0&lt;/throttler&gt;
  &lt;/Webhook&gt;
&lt;/ios&gt;
</code></pre><h5 id=url-1>Url<a href=#url-1 class=anchor aria-hidden=true>#</a></h5><p>This is the URL, to which the machinery will send a JSON object (as a POST request).</p><h5 id=throttler-4>Throttler<a href=#throttler-4 class=anchor aria-hidden=true>#</a></h5><p>Control the number of executions by setting a throttling value. E.g. if you set throttling to 5, the Webhook will only be triggered once in 5 seconds, nevertheless more detections occurred.</p><h5 id=output-1>Output<a href=#output-1 class=anchor aria-hidden=true>#</a></h5><p>A JSON object is POSTed to the url you&rsquo;ve defined.</p><pre><code class=language-json>[
  'regionCoordinates' : [618, 317, 703, 493],
  'numberOfChanges' : 5446,
  'timestamp' : '1465894497',
  'microseconds' : '5-97451',
  'token' : 695,
  'pathToImage' : '1465894497_5-97451_frontdoor_618-317-703-493_5446_695.jpg',
  'instanceName' : 'frontdoor',
]
</code></pre><h3 id=script>Script<a href=#script class=anchor aria-hidden=true>#</a></h3><p>A bash script can be executed after a valid event was detected. A JSON object is send in the first parameter to the script you&rsquo;ve defined.</p><h4 id=parameters-14>Parameters<a href=#parameters-14 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the Script output device can be found in the config/io.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;ios&gt;
  &lt;Script&gt;
    &lt;path type=&quot;text&quot;&gt;/etc/opt/kerberosio/scripts/run.sh&lt;/path&gt;
    &lt;throttler type=&quot;number&quot;&gt;0&lt;/throttler&gt;
  &lt;/Script&gt;
&lt;/ios&gt;
</code></pre><h5 id=path>Path<a href=#path class=anchor aria-hidden=true>#</a></h5><p>The location of the script that will be executed on detection.</p><h5 id=throttler-5>Throttler<a href=#throttler-5 class=anchor aria-hidden=true>#</a></h5><p>Control the number of executions by setting a throttling value. E.g. if you set throttling to 5, the Script will only be triggered once in 5 seconds, nevertheless more detections occurred.</p><h5 id=example>Example<a href=#example class=anchor aria-hidden=true>#</a></h5><p>By default the script will point to /etc/opt/kerberosio/scripts/run.sh, which contains a template how you should start your script. Note that when using KiOS, this script will be read-only, copy it to the /data folder and change the path parameter.</p><pre><code class=language-python>#!/bin/bash
# -------------------------------------------
# This is an example script which illustrates
# how to use the Script IO device.
#
# --------------------------------------
# The first parameter is the JSON object
#
# e.g. {&quot;regionCoordinates&quot;:[308,250,346,329],&quot;numberOfChanges&quot;:194,&quot;timestamp&quot;:&quot;1486049622&quot;,&quot;microseconds&quot;:&quot;6-161868&quot;,&quot;token&quot;:344,&quot;pathToImage&quot;:&quot;1486049622_6-161868_frontdoor_308-250-346-329_194_344.jpg&quot;,&quot;instanceName&quot;:&quot;frontdoor&quot;}
JSON=$1
# -------------------------------------------
# You can use python to parse the JSON object
# and get the required fields
name=$(echo $JSON | python -c &quot;import sys, json; print json.load(sys.stdin)['instanceName']&quot;)
coordinates=$(echo $JSON | python -c &quot;import sys, json; print json.load(sys.stdin)['regionCoordinates']&quot;)
changes=$(echo $JSON | pythfon -c &quot;import sys, json; print json.load(sys.stdin)['numberOfChanges']&quot;)
image=$(echo $JSON | python -c &quot;import sys, json; print json.load(sys.stdin)['pathToImage']&quot;)
The idea is that you can use Python in your bash script, to parse the JSON object send as first parameter. Afterwards you can do with the output what you want.
</code></pre><h3 id=mqtt>MQTT<a href=#mqtt class=anchor aria-hidden=true>#</a></h3><p>MQTT protocol is a light-weight Machine to Machine (M2M) protocol widely used in Internet of things.
Detailed information (a JSON object) is published to an MQTT topic. The JSON object contains the number of changes, the region, the URL of the image, etc.</p><h4 id=parameters-15>Parameters<a href=#parameters-15 class=anchor aria-hidden=true>#</a></h4><p>The parameters of the MQTT output can be found in the config/io.xml file, but you can also use the web to modify the parameters. Below you see a default configuration file.</p><pre><code class=language-xml>&lt;ios
  &lt;MQTT&gt;
    &lt;secure type=&quot;bool&quot;&gt;false&lt;/secure&gt;
    &lt;verifycn type=&quot;bool&quot;&gt;false&lt;/verifycn&gt;
    &lt;server type=&quot;number&quot;&gt;127.0.0.1&lt;/server&gt;
    &lt;port type=&quot;number&quot;&gt;1883&lt;/port&gt;
    &lt;topic type=&quot;text&quot;&gt;kios/mqtt&lt;/topic&gt;
    &lt;username type=&quot;text&quot;&gt;&lt;/username&gt;
    &lt;password type=&quot;text&quot;&gt;&lt;/password&gt;
    &lt;throttler type=&quot;number&quot;&gt;0&lt;/throttler&gt;
  &lt;/MQTT&gt;
&lt;/ios&gt;
</code></pre><h5 id=secure>Secure<a href=#secure class=anchor aria-hidden=true>#</a></h5><p>If checked, enable SSL/TLS support. Please note that when SSL/TLS support is enabled, the server certificate issuer is verified against the CA (Certification Authority) files available in /etc/ssl/certs.</p><h5 id=verifycn>Verifycn<a href=#verifycn class=anchor aria-hidden=true>#</a></h5><p>If checked, the MQTT server FQDN or ip address must match the CN (Common Name) of the server certificate.</p><h5 id=server-1>Server<a href=#server-1 class=anchor aria-hidden=true>#</a></h5><p>IP address or FQDN of the MQTT broker.</p><h5 id=port-1>Port<a href=#port-1 class=anchor aria-hidden=true>#</a></h5><p>TCP port of the MQTT broker.</p><h5 id=topic>Topic<a href=#topic class=anchor aria-hidden=true>#</a></h5><p>The topic to publish to.</p><h5 id=username>Username<a href=#username class=anchor aria-hidden=true>#</a></h5><p>The username for authenticating to the MQTT broker. This is only supported by brokers that implement the MQTT spec v3.1. If username is not set (empty), the password argument is ignored. This is only needed if the MQTT broker is configured for authentication.</p><h5 id=password>Password<a href=#password class=anchor aria-hidden=true>#</a></h5><p>The password to use, together with the username, for authenticating to the MQTT broker. This is only supported by brokers that implement the MQTT spec v3.1. This is only needed if the MQTT broker is configured for authentication.</p><h5 id=throttler-6>Throttler<a href=#throttler-6 class=anchor aria-hidden=true>#</a></h5><p>Control the number of executions by setting a throttling value. E.g. if you set throttling to 5, the MQTT will only be triggered once in 5 seconds, nevertheless more detections occurred.</p><h5 id=output-2>Output<a href=#output-2 class=anchor aria-hidden=true>#</a></h5><p>A JSON object is published to the topic of the MQTT broker you have configured.</p><pre><code class=language-json>[
  'regionCoordinates' : [618, 317, 703, 493],
  'numberOfChanges' : 5446,
  'timestamp' : '1465894497',
  'microseconds' : '5-97451',
  'token' : 695,
  'pathToImage' : '1465894497_5-97451_frontdoor_618-317-703-493_5446_695.jpg',
  'instanceName' : 'frontdoor',
]
</code></pre><h5 id=example-1>Example<a href=#example-1 class=anchor aria-hidden=true>#</a></h5><p>It is possible to subscribe multiple distributed IoT devices to the same MQTT topic and perform specific actions upon the detection of a motion. Devices with more resources could fetch the image to perform further elaboration.</p><h2 id=streaming>Streaming<a href=#streaming class=anchor aria-hidden=true>#</a></h2><p>The machinery has the ability to stream your capture device as a MJPG stream.</p><h3 id=parameters-16>Parameters<a href=#parameters-16 class=anchor aria-hidden=true>#</a></h3><p>The parameters for the supported streaming protocols can be found in the <code>config/stream.xml</code> file, but you can also use the web to modify the parameters. Below you see a default configuration file; at the moment of writing only a MJPG stream is supported.</p><pre><code class=language-xml>&lt;streams&gt;
	&lt;Mjpg&gt;
    	&lt;enabled type=&quot;bool&quot;&gt;true&lt;/enabled&gt;
    	&lt;streamPort type=&quot;number&quot;&gt;8889&lt;/streamPort&gt;
    	&lt;quality type=&quot;number&quot;&gt;75&lt;/quality&gt;
    	&lt;username type=&quot;number&quot;&gt;&lt;/username&gt;
    	&lt;password type=&quot;number&quot;&gt;75&lt;/password&gt;
    &lt;/Mjpg&gt;
&lt;/streams&gt;
</code></pre><h4 id=enabled-1>Enabled<a href=#enabled-1 class=anchor aria-hidden=true>#</a></h4><p>A boolean which turns ON/OFF the stream. This is interesting when working with IP cameras, where you already have an RTSP/MJPG stream from the camera itself.</p><h4 id=stream-port>Stream Port<a href=#stream-port class=anchor aria-hidden=true>#</a></h4><p>The port on which the stream is available.</p><h4 id=quality>Quality<a href=#quality class=anchor aria-hidden=true>#</a></h4><p>The quality is a value between [0-100]. The lower the quality, the more the image will be compressed. If you&rsquo;re using the RaspberryPi Camera module, this option will be ignored.</p><h4 id=usernamepassword>Username/password<a href=#usernamepassword class=anchor aria-hidden=true>#</a></h4><p>You can secure the MJPEG streaming with a username and password. These credentials will be used to authorize your requests using Basic Authentication. Please note that once enabled, the live stream on the dashboard page can fail; however it will work if you open it directly in your browser or ip camera client. The format of the streaming url, after authentication enabled, will look as following:</p><pre><code class=language-ts>http://username:password@ip-camera:8899
</code></pre><p class=edit-page><a href=https://github.com/kerberos-io/documentation/blob/master/content/opensource/machinery/index.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class="docs-navigation d-flex justify-content-between"><a href=https://staging.doc.kerberos.live/opensource/contribute/><div class="card my-1"><div class="card-body py-2">&larr; Contribute</div></div></a><a class=ms-auto href=https://staging.doc.kerberos.live/opensource/web/><div class="card my-1"><div class="card-body py-2">Web &rarr;</div></div></a></div></main></div></div></div><script src=https://staging.doc.kerberos.live/js/highlight.min.8cdbefd08ec63ef25f4b2510ae50c13b3d9ed43e25a15ddb55f14c33130e68cf8be3131ccf2d087c49f5f21fe88c2f0e2715a21f936047d0d0b85dc48cb864b9.js integrity="sha512-jNvv0I7GPvJfSyUQrlDBOz2e1D4loV3bVfFMMxMOaM+L4xMczy0IfEn18h/ojC8OJxWiH5NgR9DQuF3EjLhkuQ==" crossorigin=anonymous defer></script><script src=https://staging.doc.kerberos.live/main.min.89223fc6eee34e2dc10266cff3c7fc87949c595388f775ec6e93132410cef77e5ff7f24a81db03c9b9eb6d2e6d75ea5a7d22945c574b65dfeb426f65af771230.js integrity="sha512-iSI/xu7jTi3BAmbP88f8h5ScWVOI93XsbpMTJBDO935f9/JKgdsDybnrbS5tdepafSKUXFdLZd/rQm9lr3cSMA==" crossorigin=anonymous defer></script><script src=https://staging.doc.kerberos.live/index.min.0d005f1a65fe1d03c3cac4e2b3c0388b2ae6227de1ed0b8dbe77d167f26d01a8346cd62354fc9da3022212729e4d2370e5036571cb89497e9b4cceaac6ff6484.js integrity="sha512-DQBfGmX+HQPDysTis8A4iyrmIn3h7QuNvnfRZ/JtAag0bNYjVPydowIiEnKeTSNw5QNlccuJSX6bTM6qxv9khA==" crossorigin=anonymous defer></script></body></html>